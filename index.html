<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>قائمة المهام</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Scheherazade+New&display=swap" rel="stylesheet" />
   <title> Google وFirebase</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <style>
    body {
      font-family: 'Amiri', serif;
      background: linear-gradient(to bottom, #fdfcf9, #fffaf3);
      margin: 0;
      padding: 0;
      direction: rtl;
    }

    .palm {
      display: none;
    }

    .lang-toggle {
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 999;
      background: #6d4c41;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      border: none;
      cursor: pointer;
    }

    .login-screen, #mainApp {
      display: none;
      padding: 60px 20px;
      text-align: center;
    }

    .login-screen.active, #mainApp.active {
      display: block;
    }

    .login-title, .title {
      font-family: 'Scheherazade New', serif;
      font-size: 2.5rem;
      color: #4e342e;
    }

    .login-subtitle {
      font-size: 1.2rem;
      margin: 10px 0 30px;
      color: #6d4c41;
    }

    .btn, .task-btn {
      background: #795548;
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      margin: 10px 5px;
      cursor: pointer;
    }

    .category-tab {
      display: inline-block;
      background: #e0e0e0;
      color: #333;
      padding: 10px 20px;
      border-radius: 20px;
      margin: 10px 5px;
      cursor: pointer;
    }

    .category-tab.active {
      background: #795548;
      color: white;
    }

    #taskInput {
      padding: 15px;
      border-radius: 15px;
      border: 1px solid #ccc;
      width: 90%;
      margin: 20px auto;
      font-size: 1rem;
    }

    .task-item {
      background: #f3f3f3;
      padding: 15px;
      margin: 15px 10px;
      border-radius: 15px;
      text-align: right;
    }

    .task-item.completed {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .task-meta {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 10px;
    }

    .footer {
      text-align: center;
      padding: 20px;
      font-size: 0.9rem;
      color: #888;
    }

    .user-info {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .hidden {
      display: none !important;
    }

    /* New styles for improved buttons */
    .complete-btn {
      background: #4CAF50 !important;
      color: white !important;
    }

    .complete-btn:hover {
      background: #45a049 !important;
    }

    .delete-btn {
      background: #f44336 !important;
      color: white !important;
    }

    .delete-btn:hover {
      background: #d32f2f !important;
    }

    .task-buttons {
      margin-top: 10px;
      display: flex;
      gap: 5px;
      justify-content: flex-end;
    }
    #googleSignInBtn {
  display: flex;
  justify-content: center;
  margin: 20px auto;
}
  </style>
</head>
<body>
  <div class="palm" style="display: none;"></div>

  <button id="langToggle" class="lang-toggle">English</button>

  <div id="loginScreen" class="login-screen active">
    <h1 class="login-title">قائمة المهام</h1>
    <p class="login-subtitle">ابدأ بإدارة مهامك الآن</p>
    <div id="googleSignInBtn"></div>
    <p style="margin: 20px 0;">أو</p>
    <button id="demoLoginBtn" class="btn">تجربة التطبيق</button>
  </div>

  <div id="mainApp">
    <div class="user-info hidden" id="userInfo">
      <img id="userAvatar" class="user-avatar" src="" alt="User" />
      <span id="userName"></span>
    </div>

    <h1 class="title">قائمة المهام</h1>

    <div>
      <div class="category-tab active" data-cat="daily"><span>اليومية</span> <span id="dailyCount">0</span></div>
      <div class="category-tab" data-cat="weekly"><span>الأسبوعية</span> <span id="weeklyCount">0</span></div>
      <div class="category-tab" data-cat="monthly"><span>الشهرية</span> <span id="monthlyCount">0</span></div>
      <div class="category-tab" data-cat="year goal"><span>أهداف السنة</span> <span id="year goalCount">0</span></div>
    </div>

    <input type="text" id="taskInput" placeholder="أكتب مهمة جديدة..." />
    <div>
      <button id="addBtn" class="btn">إضافة مهمة</button>
      <button id="clearBtn" class="btn">مسح الكل</button>
    </div>

    <div id="tasksList"></div>
  </div>

  <div class="footer">Developed by Rasil</div>
    <h2>مهامي</h2>
  <div id="buttonDiv"></div>
  <div id="taskSection" style="display:none;">
    <input type="text" id="taskInput" placeholder="اكتب مهمة جديدة" />
    <button onclick="addTask()">إضافة</button>
    <ul id="taskList"></ul>
  </div>

<script>
const translations = {
  ar: {
    add: "إضافة مهمة",
    clear: "مسح الكل",
    complete: "إنجاز",
    cancel: "إلغاء",
    delete: "حذف",
    daily: "المهام اليومية",
    weekly: "المهام الأسبوعية",
    monthly: "المهام الشهرية",
    "year goal": "الأهداف السنوية",
    placeholder: "أكتب مهمة جديدة...",
    title: "قائمة المهام",
    subtitle: "ابدأ بإدارة مهامك الآن",
    demo: "تجربة التطبيق",
    signin: "تسجيل الدخول باستخدام Google",
    confirmClear: "هل أنت متأكد؟",
    empty: "لا توجد مهام في هذه الفئة<br>ابدأ بإضافة مهمة جديدة!"
  },
  en: {
    add: "Add Task",
    clear: "Clear All",
    complete: "Complete",
    cancel: "Undo",
    delete: "Delete",
    daily: "Daily Tasks",
    weekly: "Weekly Tasks",
    monthly: "Monthly Tasks",
    "year goal": "Yearly Goals",
    placeholder: "Write a new task...",
    title: "Task List",
    subtitle: "Start managing your tasks now",
    demo: "Try App",
    signin: "Sign in with Google",
    confirmClear: "Are you sure?",
    empty: "No tasks in this category<br>Start by adding one!"
  }
};

let language = 'ar';
let tasks = [];
let cat = 'daily';
let isGoogleUser = false;

function setLanguage(lang) {
  language = lang;
  document.getElementById('addBtn').textContent = translations[lang].add;
  document.getElementById('clearBtn').textContent = translations[lang].clear;
  document.getElementById('taskInput').placeholder = translations[lang].placeholder;
  document.querySelector('.login-title').textContent = translations[lang].title;
  document.querySelector('.login-subtitle').textContent = translations[lang].subtitle;
  document.querySelector('.title').textContent = translations[lang].title;
  document.getElementById('demoLoginBtn').textContent = translations[lang].demo;
  document.getElementById('langToggle').textContent = lang === 'ar' ? 'English' : 'العربية';
  document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
  document.querySelectorAll('.category-tab').forEach(tab => {
    const cat = tab.dataset.cat;
    tab.querySelector('span').textContent = translations[lang][cat];
  });
  render();
}

document.getElementById('langToggle').onclick = () => {
  setLanguage(language === 'ar' ? 'en' : 'ar');
};

window.onload = () => {
  google.accounts.id.initialize({
    client_id: "647272644166-5vb58i3eacufm2t6stoe2c2qqs1sc9v5.apps.googleusercontent.com",
    callback: handleCredentialResponse
  });
  google.accounts.id.renderButton(
    document.getElementById("googleSignInBtn"),
    { theme: "outline", size: "large", text: "signin_with" }
  );
  setLanguage(language);
};

function parseJwt(token) {
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
  }).join(''));
  return JSON.parse(jsonPayload);
}

function handleCredentialResponse(response) {
  const decoded = parseJwt(response.credential);
  isGoogleUser = true;
  document.getElementById('loginScreen').classList.remove('active');
  document.getElementById('mainApp').classList.add('active');
  document.getElementById('userAvatar').src = decoded.picture;
  document.getElementById('userName').textContent = decoded.name;
  document.getElementById('userInfo').classList.remove('hidden');
  updateCounts();
}

document.getElementById("demoLoginBtn").onclick = () => {
  isGoogleUser = false;
  document.getElementById("loginScreen").classList.remove("active");
  document.getElementById("mainApp").classList.add("active");
  document.getElementById('userInfo').classList.add('hidden');
  updateCounts();
};

function formatDate(dateStr) {
  const date = new Date(dateStr);
  
  const hijriFormatter = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', { 
    day: 'numeric', 
    month: 'long', 
    year: 'numeric' 
  });
  const hijriParts = hijriFormatter.formatToParts(date);
  const hijriDay = hijriParts.find(part => part.type === 'day').value;
  const hijriMonth = hijriParts.find(part => part.type === 'month').value;
  const hijriYear = hijriParts.find(part => part.type === 'year').value;
  
  const gregorianFormatter = new Intl.DateTimeFormat('en-US', { 
    day: 'numeric', 
    month: 'short', 
    year: 'numeric' 
  });
  const gregorianFormatted = gregorianFormatter.format(date);
  
  return `${hijriDay} ${hijriMonth} ${hijriYear} هـ | ${gregorianFormatted}`;
}

function updateCounts() {
  ['daily', 'weekly', 'monthly', 'year goal'].forEach(c => {
    const count = tasks.filter(t => t.cat === c && !t.done).length;
    const el = document.getElementById(c + 'Count');
    if (el) el.textContent = count;
  });
}

function render() {
  const list = document.getElementById('tasksList');
  const filtered = tasks.filter(t => t.cat === cat);
  if (!filtered.length) {
    list.innerHTML = `<div style="text-align: center; padding: 40px; color: #666;">${translations[language].empty}</div>`;
    return;
  }
  list.innerHTML = filtered.map(t => `
    <div class="task-item${t.done ? ' completed' : ''}" data-id="${t.id}">
      <div class="task-text">${t.text}</div>
      <div class="task-meta">${formatDate(t.created)}</div>
      <div class="task-buttons">
        <button class="task-btn complete-btn">${t.done ? translations[language].cancel : translations[language].complete}</button>
        <button class="task-btn delete-btn">${translations[language].delete}</button>
      </div>
    </div>
  `).join('');
}

document.querySelectorAll('.category-tab').forEach(el => {
  el.onclick = () => {
    document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
    el.classList.add('active');
    cat = el.dataset.cat;
    render();
    updateCounts();
  };
});

document.getElementById('addBtn').onclick = () => {
  const val = document.getElementById('taskInput').value.trim();
  if (val) {
    tasks.unshift({ id: Date.now(), text: val, cat, done: false, created: new Date().toISOString() });
    document.getElementById('taskInput').value = '';
    render();
    updateCounts();
  }
};

document.getElementById('taskInput').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    document.getElementById('addBtn').click();
  }
});

document.getElementById('clearBtn').onclick = () => {
  if (tasks.length === 0) {
    alert(language === 'ar' ? 'لا توجد مهام للمسح' : 'No tasks to clear');
    return;
  }
  
  const userConfirmed = confirm(translations[language].confirmClear);
  if (userConfirmed) {
    tasks = [];
    render();
    updateCounts();
  }
};

document.getElementById('tasksList').addEventListener('click', e => {
  const item = e.target.closest('.task-item');
  if (!item) return;
  const id = +item.dataset.id;
  if (e.target.classList.contains('complete-btn')) {
    tasks = tasks.map(t => t.id === id ? { ...t, done: !t.done } : t);
    render(); 
    updateCounts();
  }
  if (e.target.classList.contains('delete-btn')) {
    tasks = tasks.filter(t => t.id !== id);
    render(); 
    updateCounts();
  }
});
      // 1. إعداد Firebase
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBzrkb6xgcyF5aVv3MV3vwJSwieIgyj-ao",
  authDomain: "tasklistweb-43653.firebaseapp.com",
  projectId: "tasklistweb-43653",
  storageBucket: "tasklistweb-43653.firebasestorage.app",
  messagingSenderId: "875266511120",
  appId: "1:875266511120:web:5df1cf617ebd7784a79595",
  measurementId: "G-H694DB31BF"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
    let currentUserEmail = null;

function handleCredentialResponse(response) {
  const decoded = parseJwt(response.credential);
  isGoogleUser = true;
  currentUserEmail = decoded.email;

  // إظهار واجهة التطبيق الرئيسية
  document.getElementById('loginScreen').classList.remove('active');
  document.getElementById('mainApp').classList.add('active');

  // عرض معلومات المستخدم
  document.getElementById('userAvatar').src = decoded.picture;
  document.getElementById('userName').textContent = decoded.name;
  document.getElementById('userInfo').classList.remove('hidden');

  loadTasks();      // تحميل المهام من Firebase
  updateCounts();   // تحديث العدادات
}
    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      return JSON.parse(decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join('')));
    }
  window.onload = () => {
  google.accounts.id.initialize({
    client_id: "647272644166-5vb58i3eacufm2t6stoe2c2qqs1sc9v5.apps.googleusercontent.com"
    callback: handleCredentialResponse
  });

  google.accounts.id.renderButton(
    document.getElementById("googleSignInBtn"), // <-- هذا الزر موجود فعلًا عندك
    { theme: "outline", size: "large", text: "signin_with" }
  );

  setLanguage(language);
};
    // 3. إضافة مهمة جديدة
    function addTask() {
      const taskText = document.getElementById("taskInput").value.trim();
      if (!taskText || !currentUserEmail) return;

      db.collection("tasks").add({
        email: currentUserEmail,
        task: taskText,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        document.getElementById("taskInput").value = "";
        loadTasks();
      });
    }

    // 4. تحميل المهام للمستخدم الحالي
    function loadTasks() {
      if (!currentUserEmail) return;

      db.collection("tasks")
        .where("email", "==", currentUserEmail)
        .orderBy("timestamp", "desc")
        .get()
        .then(snapshot => {
          const list = document.getElementById("taskList");
          list.innerHTML = "";
          snapshot.forEach(doc => {
            const li = document.createElement("li");
            li.textContent = doc.data().task;
            list.appendChild(li);
          });
        });
    }

</script>
</body>
</html>
