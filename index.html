<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet" />
  
  <style>
    /* ÙƒÙ„ CSS Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ù‡Ù†Ø§ */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Amiri', serif; /* ... */ }
    /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ÙˆØ§Ù„ÙÙˆØ§ØµÙ„... */
  </style>
</head>
<body>
  <div class="palm-tree palm-tree-1"></div>
  <div class="palm-tree palm-tree-2"></div>
  <div class="palm-tree palm-tree-3"></div>

  <!-- Google Sign-In elements -->
  <div id="g_id_onload"
       data-client_id="647272644166-5vb58i3eacufm2t6stoe2c2qqs1sc9v5.apps.googleusercontent.com"
       data-context="signin"
       data-ux_mode="popup"
       data-callback="loginCallback"
       data-auto_select="true"
       data-itp_support="true">
  </div>

  <div class="g_id_signin"
       data-type="standard"
       data-shape="pill"
       data-theme="outline"
       data-text="signin_with"
       data-size="medium"
       data-logo_alignment="center">
  </div>

  <!-- Login Screen -->
  <div id="loginScreen" class="login-screen">
    <div class="login-container">
      <h1 class="login-title" id="loginTitle">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h1>
      <p id="loginSubtitle" style="margin-bottom: 30px; color: #8b7355;">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainApp" class="hidden">
    <div class="header">
      <div class="header-controls">
        <div class="user-info">
          <img id="userAvatar" src="" alt="User" class="user-avatar"/>
          <span id="userName" class="user-name"></span>
          <button id="logoutBtn" class="logout-btn"><span id="logoutText">Ø®Ø±ÙˆØ¬</span></button>
        </div>
        <button class="lang-toggle" onclick="toggleLanguage()"><span id="langText">English</span></button>
      </div>
      <h1 class="title" id="mainTitle">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h1>
    </div>

    <div class="container">
      <div class="category-tabs">
        <div class="category-tab active" data-category="daily" onclick="switchCategory('daily')">
          <span id="dailyTab">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span><div class="task-count" id="dailyCount">0</div>
        </div>
        <!-- weekly, monthly, yearly Ù…Ø«Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚ -->
      </div>

      <div class="input-section">
        <div class="input-form">
          <div class="input-row">
            <input type="text" id="taskInput" placeholder="Ø§ÙƒØªØ¨ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©..." />
          </div>
          <div class="action-buttons">
            <button class="btn add-btn" onclick="addTask()"><span id="addBtnText">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</span></button>
            <button class="btn clear-btn" onclick="clearAllTasks()"><span id="clearBtnText">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</span></button>
          </div>
        </div>
      </div>

      <div class="tasks-container">
        <div id="tasksList">
          <div class="empty-state"><div class="icon">ğŸ¯</div><p id="emptyMessage">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©<br>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©!</p></div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">Developed by Rasil</div>

  <!-- JavaScript -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    function loginCallback(response) {
      // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† ÙÙƒ Ø±Ù…Ø² ID token Ù…Ù† GoogleØŒ Ø«Ù… Ø§Ù„Ø¹Ø±Ø¶:
      currentUser = { name: 'Ø§Ø³Ù…Ùƒ Ù…Ù† Google', avatar: '' };
      document.getElementById('userName').innerText = currentUser.name;
      document.getElementById('userAvatar').src = currentUser.avatar || 'https://via.placeholder.com/40';
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
    }

    const translations = {
      ar: { /* ... */ },
      en: { /* ... */ }
    };
    let tasks = [], currentLang = 'ar', currentCategory = 'daily', currentUser = null;

    function switchCategory(cat) { /* ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙØ¦Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯Ø§Øª */ }
    function clearAllTasks() {
      if (confirm(translations[currentLang].confirmClear)) {
        tasks = [];
        renderTasks();
        saveToServer();
      }
    }
    function saveToServer() {
      fetch('/update_tasks', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tasks }) });
    }
    function addTask() {
      const input = document.getElementById('taskInput');
      if (input.value.trim()) {
        tasks.push({ text: input.value.trim(), done: false, id: Date.now(), category: currentCategory });
        input.value = '';
        renderTasks();
        saveToServer();
      }
    }
    function toggleDone(id) {
      const t = tasks.find(x => x.id === id);
      if (t) t.done = !t.done;
      renderTasks(); saveToServer();
    }
    function deleteTask(id) {
      tasks = tasks.filter(x => x.id !== id);
      renderTasks(); saveToServer();
    }

    function renderTasks() {
      const div = document.getElementById('tasksList');
      div.innerHTML = '';
      const filtered = tasks.filter(t => t.category === currentCategory);
      if (filtered.length === 0) {
        div.innerHTML = `<div class="empty-state"><div class="icon">ğŸ¯</div><p>${translations[currentLang].emptyState}</p></div>`;
      } else {
        filtered.forEach(t => {
          const item = document.createElement('div');
          item.className = `task-item${t.done ? ' completed' : ''}`;
          item.innerHTML = `
            <div class="task-header">
              <span class="task-text">${t.text}</span>
              <div class="task-actions">
                <button class="task-btn complete-btn" onclick="toggleDone(${t.id})">
                  ${t.done ? translations[currentLang].undoBtn : translations[currentLang].completeBtn}
                </button>
                <button class="task-btn delete-btn" onclick="deleteTask(${t.id})">
                  ${translations[currentLang].deleteBtn}
                </button>
              </div>
            </div>`;
          div.appendChild(item);
        });
      }
      // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ¦Ø§Øª Ø¥Ù† Ø£Ø±Ø¯Øª count
    }

    function toggleLanguage() {
      currentLang = currentLang === 'ar' ? 'en' : 'ar';
      // Ù‡Ù†Ø§ ØªØºÙŠÙŠØ± Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
    }

    window.addEventListener('DOMContentLoaded', () => {
      renderTasks();
    });

    document.getElementById('logoutBtn')?.addEventListener('click', () => window.location = '/logout');
  </script>
</body>
</html>
