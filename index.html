<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>قائمة المهام</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet"/>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Amiri', serif;
      background:linear-gradient(135deg,#fefefe,#f8f8f8);
      min-height:100vh;
      color:#5d4e37;
      overflow-x:hidden;
      position:relative;
    }
    /* تأثيرات النخيل خلفية */
    body::before,.palm-tree { pointer-events:none; position:fixed; z-index:-1; opacity:0.06; }
    body::before {
      content:'';
      top:0; left:0; width:100%; height:100%;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 300"><g fill="%23228B22" opacity="0.1"><path d="M100 200 Q80 150 60 120 Q40 90 20 80 Q50 85 80 100 Q90 110 100 130 Q110 110 120 100 Q150 85 180 80 Q160 90 140 120 Q120 150 100 200 Z"/><rect x="95" y="200" width="10" height="80" fill="%238B4513"/><ellipse cx="100" cy="280" rx="20" ry="8" fill="%23228B22"/></g></svg>'),
                      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 300"><g fill="%23228B22" opacity="0.08"><path d="M100 180 Q85 140 70 115 Q55 90 35 85 Q60 88 85 100 Q95 108 100 125 Q105 108 115 100 Q140 88 165 85 Q145 90 130 115 Q115 140 100 180 Z"/><rect x="95" y="180" width="10" height="70" fill="%238B4513"/><ellipse cx="100" cy="250" rx="18" ry="7" fill="%23228B22"/></g></svg>');
      background-size:300px 400px,250px 350px;
      background-position:-50px 20%,calc(100%+50px) 60%;
      background-repeat:no-repeat;
    }
    .palm-tree-1 { top:10%; left:5%; width:180px; height:250px; background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"...') no-repeat center;background-size:contain;}
    .palm-tree-2 { top:40%; right:8%; width:160px; height:220px; background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"...') no-repeat center;background-size:contain;}
    .palm-tree-3 { bottom:20%; left:10%; width:140px; height:190px; background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"...') no-repeat center;background-size:contain;}

    /* شاشة تسجيل الدخول */
    .login-screen {
      display:flex;
      justify-content:center;
      align-items:center;
      position:fixed;
      top:0; left:0; width:100%; height:100%;
      background:rgba(255,255,255,0.9);
      backdrop-filter:blur(10px);
      z-index:10;
    }
    .login-container {
      background:rgba(255,255,255,0.95);
      backdrop-filter:blur(15px);
      border-radius:30px;
      padding:50px;
      text-align:center;
      border:2px solid rgba(139,69,19,0.3);
      box-shadow:0 15px 35px rgba(139,69,19,0.2);
      max-width:400px;
      width:90%;
    }
    .login-title {
      font-family:'Scheherazade New',serif;
      font-size:3rem;font-weight:700;
      background:linear-gradient(45deg,#8b4513,#d2691e,#a0522d);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      margin-bottom:30px;
    }
    .google-signin-btn { margin:0 auto; }

    /* باقي CSS للواجهة الرئيسية... */
    /* انسخ كل ستايلاتك القديمة الخاصة بال mainApp والفوتر هنا */
  </style>
</head>
<body>
  <div class="palm-tree palm-tree-1"></div>
  <div class="palm-tree palm-tree-2"></div>
  <div class="palm-tree palm-tree-3"></div>

  <!-- شاشة تسجيل الدخول مركزة تمامًا -->
  <div id="loginScreen" class="login-screen">
    <div class="login-container">
      <h1 class="login-title" id="loginTitle">قائمة المهام</h1>
      <p id="loginSubtitle" style="margin-bottom:30px;color:#8b7355;">سجل دخولك للمتابعة</p>
      <div id="googleSignInBtn"></div>
      <p id="errorMsg" style="color:red; margin-top:15px; display:none;">لم تتم عملية تسجيل الدخول، ربما تم رفض الأذونات.</p>
    </div>
  </div>

  <!-- الواجهة الرئيسية مخفية عند البدء -->
  <div id="mainApp" class="hidden">
    <!-- انسخ هنا كل عناصر الواجهة: header, category-tabs, input-section, tasks-container, footer -->
    <!-- تأكد من تضمين عناصر: userAvatar, userName, logoutBtn, lang-toggle, taskInput، etc. -->
  </div>

  <script>
    let tasks = [], currentLang='ar', currentCategory='daily', currentUser=null;
    const translations = {
      ar:{ /* ... ترجماتك ... */ },
      en:{ /* ... ترجماتك ... */ }
    };

    function handleCredentialResponse(res) {
      if(!res.credential) {
        showError();
        return;
      }
      const payload = JSON.parse(atob(res.credential.split('.')[1]));
      currentUser = { name:payload.name, picture:payload.picture, sub:payload.sub };
      hideError();
      loadTasks();
      onSignIn();
      initMainApp();
    }

    function showError() {
      document.getElementById('errorMsg').style.display = 'block';
    }
    function hideError() {
      document.getElementById('errorMsg').style.display = 'none';
    }

    function renderGoogleButton() {
      google.accounts.id.initialize({
        client_id: 'YOUR_CLIENT_ID.apps.googleusercontent.com',
        callback: handleCredentialResponse,
        ux_mode: 'popup'
      });
      google.accounts.id.renderButton(
        document.getElementById('googleSignInBtn'),
        { theme:'outline', size:'large', locale:currentLang }
      );
    }

    function init() {
      renderGoogleButton();
    }

    function onSignIn() {
      document.getElementById('loginScreen').style.display='none';
      document.getElementById('mainApp').classList.remove('hidden');
    }

    function logout() {
      currentUser=null; tasks=[]; saveTasks();
      google.accounts.id.disableAutoSelect();
      document.getElementById('mainApp').classList.add('hidden');
      document.getElementById('loginScreen').style.display='flex';
    }

    function saveTasks() {
      if(currentUser) localStorage.setItem(`tasks_${currentUser.sub}`, JSON.stringify(tasks));
    }
    function loadTasks() {
      if(currentUser) {
        const d = localStorage.getItem(`tasks_${currentUser.sub}`);
        tasks = d?JSON.parse(d):[];
      }
    }

    function initMainApp() {
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userAvatar').src = currentUser.picture;
      // هنا تنادي init الدوال: updateLanguage(), setupEventListeners(), renderTasksUI(), updateTaskCounts()
      updateLanguage();
      setupEventListeners();
      renderTasksUI();
      updateTaskCounts();
    }

    // أمثلة للدوال:
    function setupEventListeners() {
      document.getElementById('logoutBtn').addEventListener('click', logout);
      document.querySelector('.lang-toggle').addEventListener('click', toggleLanguage);
      // أضف مستمع add-task, clear-all, switch-category, complete, delete
    }

    function toggleLanguage() {
      currentLang = currentLang==='ar'?'en':'ar';
      updateLanguage();
      // إعادة تهيئة زر Google ليتوافق مع اللغة الجديدة
      renderGoogleButton();
      renderTasksUI();
      updateTaskCounts();
    }

    // أكمل دوال: updateLanguage(), addTask(), clearAllTasks(), switchCategory(), renderTasksUI(), updateTaskCounts()
    // انسخها من كودك القديم وادمجها إلى هنا

    window.onload = init;
  </script>
</body>
</html>
